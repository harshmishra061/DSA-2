class Solution {
    TreeNode* buildTree2(vector<int>& inorder, vector<int>& postorder, int inStart, int inEnd, int postStart, int postEnd) {
        if(inStart > inEnd) return NULL;
        int pos = inStart;
        while(inorder[pos] != postorder[postEnd]) pos++;

        int rightLength = inEnd - pos;

        int leftInStart = inStart;
        int leftInEnd = pos - 1;
        int leftPostStart = postStart;
        int leftPostEnd = postEnd - rightLength - 1;
        int rightInStart = pos + 1;
        int rightInEnd = inEnd;
        int rightPostStart = postEnd - rightLength;
        int rightPostEnd = postEnd - 1;

        TreeNode* node = new TreeNode(postorder[postEnd]);
        node->left = buildTree2(inorder, postorder, leftInStart, leftInEnd, leftPostStart, leftPostEnd);
        node->right = buildTree2(inorder, postorder, rightInStart, rightInEnd, rightPostStart, rightPostEnd);
        return node;
    }
public:
    TreeNode* buildTree(vector<int>& inorder, vector<int>& postorder) {
        return buildTree2(inorder, postorder, 0, inorder.size() - 1, 0, postorder.size() - 1);
    }
};
